How to Deploy a Multi-Tier Web Application with Kubernetes

Deploying a Multi-Tier Web Application on Kubernetes with Nginx, App Server, and RDS

This guide will walk you through setting up a multi-tier web application on Kubernetes, where:

âœ… Nginx acts as the Web Tier (Frontend & Reverse Proxy)
âœ… App Server (Sample Node.js, Flask, or Spring Boot app) is the Application Tier
âœ… Amazon RDS (MySQL/PostgreSQL) is the Database Tier
âœ… All components run in private subnets, accessing the internet via NAT
âœ… ConfigMap and Secrets are used for environment variables
âœ… Separate namespaces per customer

ğŸŒŸ High-Level Architecture

 



             Internet
                 |
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  NAT Gateway â”‚   (Outbound internet access)
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Private Kubernetes Cluster   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Namespace: customer1          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Nginx       â”‚   Web Tier  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ App Server   â”‚  App Tier    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   RDS (AWS)  â”‚  DB Tier     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸš€ Step-by-Step Deployment Guide

1ï¸âƒ£ Create Kubernetes Namespace

Each customer gets a dedicated namespace.



kubectl create namespace customer1 
2ï¸âƒ£ Create ConfigMap for Application Configs

Stores non-sensitive environment variables.



apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: customer1
data:
  DATABASE_HOST: "customer1-db.c9b7a3w1.us-east-1.rds.amazonaws.com"
  DATABASE_PORT: "3306"
Apply it:



kubectl apply -f app-configmap.yaml 
3ï¸âƒ£ Create Secrets for Sensitive Data

Stores sensitive credentials (e.g., DB username/password).



apiVersion: v1
kind: Secret
metadata:
  name: db-secrets
  namespace: customer1
type: Opaque
data:
  DB_USER: "dXNlcm5hbWU="  # Base64 encoded username
  DB_PASSWORD: "cGFzc3dvcmQ="  # Base64 encoded password
Apply it:



kubectl apply -f db-secrets.yaml 
4ï¸âƒ£ Deploy Nginx as the Web Tier

Nginx Deployment



apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  namespace: customer1
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
Nginx Service



apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  namespace: customer1
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: ClusterIP
Apply it:



kubectl apply -f nginx-deployment.yaml kubectl apply -f nginx-service.yaml 
5ï¸âƒ£ Deploy Application Server

Application Deployment



apiVersion: apps/v1
kind: Deployment
metadata:
  name: appserver
  namespace: customer1
spec:
  replicas: 2
  selector:
    matchLabels:
      app: appserver
  template:
    metadata:
      labels:
        app: appserver
    spec:
      containers:
      - name: appserver
        image: myregistry.com/appserver:latest
        ports:
        - containerPort: 5000
        env:
        - name: DB_HOST
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DATABASE_HOST
        - name: DB_PORT
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DATABASE_PORT
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: DB_USER
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secrets
              key: DB_PASSWORD
 

Application Service



apiVersion: v1
kind: Service
metadata:
  name: appserver-service
  namespace: customer1
spec:
  selector:
    app: appserver
  ports:
    - protocol: TCP
      port: 5000
      targetPort: 5000
  type: ClusterIP 
Apply it:



kubectl apply -f appserver-deployment.yaml kubectl apply -f appserver-service.yaml 
6ï¸âƒ£ Deploy Amazon RDS

Create Amazon RDS (MySQL/PostgreSQL) instance in private subnet.

Ensure Security Group allows Kubernetes appserver IPs.

Store RDS hostname in ConfigMap.

7ï¸âƒ£ Use NAT Gateway for Outbound Traffic

Attach NAT Gateway to the private subnet.

Ensure nodes in private subnet can access the internet via NAT for pulling container images, updates, etc..

8ï¸âƒ£ Verify Deployment

Check running services:



kubectl get pods -n customer1 kubectl get services -n customer1 
Test Nginx â†’ Appserver â†’ RDS flow:



curl http://nginx-service.customer1.svc.cluster.local 
ğŸš€ Key Takeaways

âœ” Namespace isolation for customers
âœ” ConfigMap & Secrets for environment variables
âœ” Kubernetes Services (ClusterIP) for internal communication
âœ” Private subnet with NAT for outbound internet
âœ” RDS hosted in private subnet
